**spring AOP实现机制，jdk动态代理和cglib动态代理**

jdk动态代理用于代理实现了接口的类

cglib用于对类进行代理，生成被代理类的子类，用相同的方法覆盖被代理类的方法。

**cglib怎样生成被代理类的子类**

**cglib生成被代理类的子类怎么加载到Jvm的？**

##**JVM类加载分为5个过程：加载，验证，准备，解析，初始化，使用，卸载**

-**1.1 加载**

加载主要是将.class文件中的二进制字节流读入到JVM中。在加载阶段，JVM需要完成3件事：

1）通过累的全限定名获取该类的二进制字节流；
2）将字节流所代表的静态存储结构转化为方法去的运行时数据结构；
3）在内存中生成一个该类的java.lang.Class对象，作为方法区这个类的各种数据的访问入口。

-**1.2 连接**

-**1.2.1 验证** 

验证是连接阶段的第一步，主要确保加载进来的字节流符合JVM规范。
```java
验证阶段会完成以下4个阶段的检验动作：
1）文件格式验证
2）元数据验证（是否符合Java语言规范）
3）字节码验证（确定程序语义合法，符合逻辑）
4）符号引用验证（确保下一步的解析能正常执行）
```

-**1.2.2 准备**

准备是连接阶段的第二步，主要为静态变量在方法区分配内存，并设置默认初始值

-**1.2.3 解析**

解析是连接阶段的第三步，主要是根据程序中的赋值语句主动为类变量赋值。

```java
注：
1）当有父类且父类为初始化的时候，先去初始化父类；
2）再进行子类初始化语句。
```

**什么时候需要对类进行初始化？**

```java
1）使用new该类实例化对象的时候；
2）读取或设置类静态字段的时候（但被final修饰的字段，在编译器时就被放入常量池的静态字段除外static final）；
3）调用类静态方法的时候；
4）使用反射Class.forName("xxx")对类进行反射调用的时候，该类需要初始化；
5）初始化一个类的时候，由父类，先初始化父类（注：1. 接口除外，父接口在调用的时候才会被初始化；2.子类引用父类静态字段，只会引发父类初始化）；
6）被标明为启动类的类（即包含main()方法的类）要初始化；
7）当使用JJDK1.7的动态语言支持时，如果一个java.invoke.MethodHandle实例最后的解析结果REF_getStatic、REF_putStatic、REF_invokeStatic的方法句柄，并且这个方法句柄所对应的类没有进行过初始化，需要先触发其初始化。
```

##**双亲委派模型的工作过程**

如果一个类接受到类加载请求，他自己不会去加载这个请求，而是将这个类加载请求委派给父类加载器，这样一层一层传送，直到到达启动类加载器（Bootstrap ClassLoader）.

只有当父类加载器无法加载这个请求时，子加载器才会尝试自己去加载。

##**线程池的源码**

**guava cache 缓存的内容是放在内存的那个位置（放在heap中）**

**eccache有没有用过？**

```java
Ehcache支持持久化到本地磁盘，Guava不可以；

Ehcache有现成的集群解决方案，Guava没有。不过个人感觉比较鸡肋，对JVM级别的缓存来讲太重了；

Ehcache jar包庞大，Guava Cache只是Guava jar包中的工具之一，而且后者远远小于Ehcache；

两种缓存当缓存过期或者没有命中的时候都可以通过load接口重载数据，调用方式略有不同。两者的主要区别是Ehcache的缓存load的时候，允许用户返回null，而Guava Cache则不允许返回为null，因为Guava Cache是根据value的值是否为null来判断是否需要load，所以不允许返回为null，但是使用的时候可以使用空对象替换。不允许返回null是一个很好的考虑；

Ehcache有内存占用大小统计，Guava Cache没有，需要自己开发；

Ehcache在put缓存的时候，对K、V都做了包装，对GC有一定影响。
```

##**什么时候适用Ehcache、什么时候适用Guava cache?**

首先，两者都是很成熟的JVM级别缓存，所以在绝大多数情况都是可以满足要求的。

**适用Ehcache的情况**

```java
需要持久化持久化。使用持久化功能需要，缓存稳定，以免持久化的数据不准确影响结果。

有集群解决方案。
```java

**适用Guava cache的情况**

Guavacache说简单点就是一个支持LRU的ConCurrentHashMap，它没有Ehcache那么多的各种特性，只是提供了增、删、改、查、刷新规则和时效规则设定等最基本的元素。做一个jar包中的一个功能之一，Guava cache极度简洁并能满足觉大部分人的要求。

##**总结**

Ehcache有着全面的缓存特性，但是略重。Guava cache有最基本的缓存特性，很轻。大家根据具体情况选择使用。